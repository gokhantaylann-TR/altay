<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Altay'ƒ±n Macerasƒ±</title>

<script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser-arcade-physics.min.js"></script>

<style>
body { margin:0; background:#000; overflow:hidden; touch-action:none; }
#ui {
  position: fixed;
  bottom: 20px;
  left: 0;
  right: 0;
  display: flex;
  justify-content: space-between;
  padding: 0 20px;
  z-index: 999;
}
.btn {
  font-size: 26px;
  background: rgba(255,255,255,0.25);
  color: #fff;
  border-radius: 12px;
  padding: 14px 18px;
  user-select: none;
}
.top-ui {
  position: fixed;
  top: 10px;
  right: 10px;
  z-index: 999;
}
</style>
</head>
<body>

<div class="top-ui">
  <span class="btn" id="pauseBtn">‚è∏</span>
  <span class="btn" id="soundBtn">üîä</span>
</div>

<div id="ui">
  <div>
    <span class="btn" id="leftBtn">‚¨ÖÔ∏è</span>
    <span class="btn" id="rightBtn">‚û°Ô∏è</span>
  </div>
  <span class="btn" id="jumpBtn">‚¨ÜÔ∏è</span>
</div>

<script>
/* ------------------------------------------------ */
let soundOn = true, paused = false;
const worldWidth = 4200;
let player, platforms, bricks, diamonds, enemies, castle, clouds=[];
let left=false, right=false, jump=false;
let level = 1;

const config = {
  type: Phaser.AUTO,
  width: 800,
  height: 600,
  scale: { mode: Phaser.Scale.FIT, autoCenter: Phaser.Scale.CENTER_BOTH },
  physics: { default: 'arcade', arcade: { gravity: { y: 1400 }, debug: false } },
  scene: { preload, create, update }
};

new Phaser.Game(config);

/* ------------------ PRELOAD ------------------ */
function preload() {
  this.load.image('sky','https://labs.phaser.io/assets/skies/sky4.png');
  this.load.image('ground','https://labs.phaser.io/assets/sprites/platform.png');
  this.load.image('brick','https://labs.phaser.io/assets/sprites/block.png');
  this.load.spritesheet('altay','https://labs.phaser.io/assets/sprites/dude.png',{frameWidth:32,frameHeight:48});

  this.load.audio('jumpS','https://labs.phaser.io/assets/audio/SoundEffects/jump.mp3');
  this.load.audio('coinS','https://labs.phaser.io/assets/audio/SoundEffects/p-ping.mp3');
  this.load.audio('stompS','https://labs.phaser.io/assets/audio/SoundEffects/shot1.wav');
  this.load.audio('winS','https://labs.phaser.io/assets/audio/SoundEffects/escape.mp3');
}

/* ------------------ CREATE ------------------ */
function create() {
  this.physics.world.setBounds(0,0,worldWidth,600);
  this.add.tileSprite(0,0,worldWidth,600,'sky').setOrigin(0);

  createClouds(this);

  platforms = this.physics.add.staticGroup();
  for(let i=0;i<worldWidth/400;i++){
    platforms.create(400*i+200,568,'ground').setScale(2).refreshBody();
  }

  bricks = this.physics.add.staticGroup();
  bricks.create(600,350,'brick');
  bricks.create(640,350,'brick');
  bricks.create(680,350,'brick');

  diamonds = this.physics.add.staticGroup();
  let d = diamonds.create(640,310);
  d.setTexture(createDiamond(this)).setScale(0.45).refreshBody();

  player = this.physics.add.sprite(100,450,'altay').setCollideWorldBounds(true);

  this.anims.create({key:'left',frames:this.anims.generateFrameNumbers('altay',{start:0,end:3}),frameRate:10,repeat:-1});
  this.anims.create({key:'right',frames:this.anims.generateFrameNumbers('altay',{start:5,end:8}),frameRate:10,repeat:-1});
  this.anims.create({key:'idle',frames:[{key:'altay',frame:4}]});

  enemies = this.physics.add.group();
  spawnDuck(this,900);
  spawnDuck(this,1600);
  spawnDuck(this,2400);

  castle = this.physics.add.staticSprite(3800,430,createCastle(this)).refreshBody();
  animateFlag(this);

  this.cameras.main.setBounds(0,0,worldWidth,600);
  this.cameras.main.startFollow(player,true,0.08,0.08);

  this.physics.add.collider(player,platforms);
  this.physics.add.collider(player,bricks);
  this.physics.add.collider(enemies,platforms);
  this.physics.add.overlap(player,diamonds,collectDiamond,null,this);
  this.physics.add.overlap(player,enemies,hitEnemy,null,this);
  this.physics.add.overlap(player,castle,finishLevel,null,this);

  setupControls(this);
}

/* ------------------ UPDATE ------------------ */
function update() {
  if(paused) return;

  clouds.forEach(c => c.x -= 0.1);

  if(left){ player.setVelocityX(-220); player.anims.play('left',true); player.flipX=true; }
  else if(right){ player.setVelocityX(220); player.anims.play('right',true); player.flipX=false; }
  else { player.setVelocityX(0); player.anims.play('idle'); }

  if(jump && player.body.touching.down){
    player.setVelocityY(-650);
    if(soundOn) this.sound.play('jumpS');
    jump=false;
  }

  enemies.children.iterate(e=>{
    if(!e) return;
    if(Math.abs(player.x - e.x) < 180) e.setVelocityX(e.dir*140);
    if(e.body.blocked.left) e.dir=1;
    if(e.body.blocked.right) e.dir=-1;
  });
}

/* ------------------ GAME LOGIC ------------------ */
function hitEnemy(p,e){
  if(p.body.touching.down){
    e.destroy();
    if(soundOn) p.scene.sound.play('stompS');
    p.setVelocityY(-300);
  } else {
    location.reload();
  }
}
function collectDiamond(p,d){
  d.destroy();
  if(soundOn) p.scene.sound.play('coinS');
}
function finishLevel(){
  if(soundOn) this.sound.play('winS');
  alert("üéâ B√∂l√ºm Tamamlandƒ±!");
}

/* ------------------ CONTROLS ------------------ */
function setupControls(scene){
  leftBtn.onpointerdown=()=>left=true;
  rightBtn.onpointerdown=()=>right=true;
  jumpBtn.onpointerdown=()=>jump=true;
  document.onpointerup=()=>{left=false; right=false;};

  pauseBtn.onclick=()=>{
    paused=!paused;
    paused ? scene.physics.pause() : scene.physics.resume();
  };
  soundBtn.onclick=()=>{
    soundOn=!soundOn;
    soundBtn.textContent = soundOn ? "üîä" : "üîá";
  };
}

/* ------------------ HELPERS ------------------ */
function spawnDuck(scene,x){
  let e = scene.physics.add.sprite(x,520,createDuck(scene));
  e.body.setSize(20,20);
  e.dir = -1;
  enemies.add(e);
}
function createDuck(scene){
  if(scene.textures.exists('duck')) return 'duck';
  const g=scene.make.graphics({add:false});
  g.fillStyle(0xffcc00).fillRect(4,8,20,12);
  g.fillStyle(0xff8800).fillRect(20,12,6,4);
  g.generateTexture('duck',28,28);
  return 'duck';
}
function createDiamond(scene){
  if(scene.textures.exists('diamond')) return 'diamond';
  const g=scene.make.graphics({add:false});
  g.fillStyle(0x00ffff);
  g.beginPath();
  g.moveTo(16,0); g.lineTo(32,16); g.lineTo(16,32); g.lineTo(0,16);
  g.closePath(); g.fillPath();
  g.generateTexture('diamond',32,32);
  return 'diamond';
}
function createCastle(scene){
  if(scene.textures.exists('castle')) return 'castle';
  const g=scene.make.graphics({add:false});
  g.fillStyle(0x888888).fillRect(0,60,128,100);
  g.fillStyle(0xaa0000).fillRect(0,30,128,30);
  g.fillStyle(0x444444).fillRect(54,110,20,50);
  g.fillStyle(0xffffff).fillRect(60,0,8,30); // flag pole
  g.fillStyle(0xff0000).fillRect(68,4,20,12); // flag
  g.generateTexture('castle',128,160);
  return 'castle';
}
function animateFlag(scene){
  scene.tweens.add({
    targets: scene.textures.get('castle').getSourceImage(),
    duration:800, repeat:-1, yoyo:true
  });
}
function createClouds(scene){
  const g=scene.make.graphics({add:false});
  g.fillStyle(0xffffff);
  g.fillCircle(40,40,20);
  g.fillCircle(60,30,25);
  g.fillCircle(80,40,20);
  g.generateTexture('cloud',120,80);

  [300,900,1500,2300,3100].forEach(x=>{
    let c = scene.add.image(x,120,'cloud').setScrollFactor(0.2).setAlpha(0.8);
    clouds.push(c);
  });
}
</script>
</body>
</html>